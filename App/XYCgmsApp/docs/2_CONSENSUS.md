# XYCgmsApp 需求共识文档

## 1. 需求描述

### 1.1 项目概述

XYCgmsApp是一个跨平台的实时血糖监测应用，旨在为糖尿病患者提供便捷、直观的血糖管理解决方案。
通过与CGMS设备的蓝牙连接，实现血糖数据的实时获取、存储、分析和预警，帮助用户更好地管理自己的健康状况。

### 1.2 核心功能需求

#### 1.2.1 蓝牙通信功能
- **设备发现与连接**：扫描并连接CGMS蓝牙设备
- **数据传输**：实时接收血糖监测数据
- **设备管理**：支持设备配对、重连、信息查看

#### 1.2.2 数据存储功能
- **本地存储**：将血糖数据加密存储在设备本地
- **云端同步**：将数据定期同步至云端服务器
- **数据完整性**：确保数据在传输和存储过程中的完整性

#### 1.2.3 数据可视化功能
- **血糖曲线图**：展示实时及历史血糖变化趋势，支持滑动查看不同时间范围的血糖数据
- **统计分析**：提供血糖相关统计数据和指标
- **多时间维度**：支持查看不同时间段（日/周/月/年）的数据

#### 1.2.4 预警系统功能
- **阈值设置**：支持用户自定义血糖高低预警阈值
- **实时预警**：当血糖异常时触发预警通知
- **预警历史**：记录并展示预警历史记录

#### 1.2.5 多平台适配
- **跨平台支持**：iOS、iPadOS、macOS、watchOS
- **平台特性适配**：针对不同平台优化用户体验

## 2. 技术实现方案

### 2.1 技术栈选择

| 类别 | 技术/框架 | 版本 | 选型理由 |
|------|-----------|------|----------|
| 开发语言 | Swift | 5.5+ | 原生支持多平台开发，性能优异 |
| UI框架 | SwiftUI | 3.0+ | 跨平台UI框架，声明式设计，适配多屏幕 |
| 蓝牙通信 | Core Bluetooth | - | iOS/macOS/watchOS原生蓝牙框架 |
| 本地存储 | Core Data | - | 原生持久化框架，支持事务和关系模型 |
| 加密方案 | CommonCrypto | - | 系统级加密库，提供高安全性 |
| 网络请求 | URLSession | - | 原生网络请求框架，性能可靠 |
| 图表展示 | Charts | iOS 16+ | SwiftUI原生图表框架，简洁高效 |
| 测试框架 | XCTest | - | 原生测试框架，与Xcode深度集成 |

### 2.2 系统架构

采用分层架构设计，确保各模块职责清晰、耦合度低：

1. **表示层**：SwiftUI视图组件，负责用户界面呈现
2. **业务逻辑层**：核心业务处理，协调各功能模块
3. **数据访问层**：处理本地和云端数据存储与检索
4. **基础设施层**：提供蓝牙通信、网络请求等基础服务

### 2.3 关键技术决策

#### 2.3.1 蓝牙通信方案
- 使用Core Bluetooth框架实现BLE（低功耗蓝牙）通信
- 实现自动重连机制，确保连接稳定性
- 采用后台处理模式，支持应用在后台时继续接收数据

#### 2.3.2 数据存储方案
- 本地使用Core Data进行结构化存储
- 实现数据加密机制，确保敏感健康数据安全
- 采用增量同步策略，减少网络消耗

#### 2.3.3 多平台适配策略
- 采用SwiftUI的响应式布局，自适应不同屏幕尺寸
- 使用条件编译和平台特性检测，处理平台差异
- 考虑各平台输入方式和交互习惯，优化用户体验

### 2.4 集成方案

#### 2.4.1 云端API集成
- 采用RESTful API架构设计
- 使用JWT进行身份认证
- 实现离线数据缓存和同步机制

#### 2.4.2 通知系统集成
- 使用UserNotifications框架实现本地通知
- 结合远程通知支持，实现关键预警的推送

## 3. 任务边界限制

### 3.1 功能边界
- 仅支持特定型号CGMS设备的连接（需明确具体型号）
- 不包括医疗诊断功能，仅提供数据监测和参考
- 不支持胰岛素泵等其他设备的直接控制

### 3.2 技术边界
- 依赖iOS/macOS/watchOS原生API，不使用跨平台框架（如Flutter、React Native）
- 本地数据存储量上限取决于设备存储空间
- 网络功能依赖用户网络连接状态

### 3.3 性能边界
- 蓝牙通信响应时间：≤1秒
- 数据同步延迟：≤5秒（网络正常情况下）
- 应用启动时间：≤3秒（设备型号不同可能有差异）

## 4. 验收标准

### 4.1 功能验收标准

#### 4.1.1 蓝牙通信
- 能成功扫描并识别支持的CGMS设备
- 连接成功率≥95%（在有效蓝牙范围内）
- 断开连接后能自动重连
- 能稳定接收实时血糖数据，数据更新频率符合预期

#### 4.1.2 数据存储
- 血糖数据能正确存储至本地数据库
- 本地数据能成功同步至云端（网络可用时）
- 断网状态下数据能正常记录，网络恢复后自动同步
- 能正确导出历史数据（CSV格式）

#### 4.1.3 数据可视化
- 血糖曲线图表显示清晰，数据点准确
- 支持切换不同时间维度查看数据
- 异常值在图表中有明显标记
- 统计数据计算准确

#### 4.1.4 预警系统
- 当血糖超出设定阈值时能准确触发预警
- 支持多种预警方式（声音、震动、通知等）
- 预警历史记录完整可查

#### 4.1.5 多平台适配
- 在所有支持平台上能正常安装和运行
- UI适配各平台屏幕尺寸和布局
- 各平台功能完整一致（除平台限制外）

### 4.2 非功能验收标准

#### 4.2.1 性能要求
- 应用响应时间≤1秒（常规操作）
- 电池消耗正常，不出现异常耗电
- 内存占用合理，无内存泄漏

#### 4.2.2 安全性要求
- 用户数据存储和传输必须加密
- 符合相关医疗数据隐私法规
- 敏感操作需要用户授权

#### 4.2.3 可用性要求
- 界面直观易懂，操作流程清晰
- 提供必要的错误提示和引导
- 支持基本的无障碍功能

## 5. 风险评估

### 5.1 技术风险
- 蓝牙连接稳定性受环境影响较大，可能出现连接中断
- 不同平台的API差异可能增加开发复杂度
- 数据安全和隐私保护需符合严格要求

### 5.2 实施风险
- 缺乏CGMS设备的具体规格可能导致开发延迟
- 跨平台适配工作量可能超出预期
- 医疗相关应用的审核和合规要求严格

### 5.3 缓解策略
- 实现健壮的错误处理和重连机制
- 建立清晰的平台差异适配指南
- 尽早咨询法律和合规专家，确保符合相关规定

---

本文档为项目开发提供了明确的需求描述、技术实现方案和验收标准，所有关键假设已在文档中明确说明。后续开发将基于此共识文档进行。